# Session Report - 18.2.2026

## Scope
Dnes sa riešili finite resource nodes (Tree/Wheat/Stone), detail panel akcie pre obnovu uzlov a farebné cost stavy v UI.

## Hotfixy a implementácia

### 1) Build/Upgrade cost farby (HUD)
- Do `GameHUDController` boli doplnené nastaviteľné farby:
  - `affordableCostColor` (default zelená)
  - `missingCostColor` (default červená)
- Farbenie je aktívne pre:
  - Build menu karty
  - Upgrade costy v inspectore
- Cost texty sa obnovujú live pri zmene zdrojov.

### 2) Finite node: hide namiesto destroy
- `FiniteResourceNode` bol upravený tak, že pri deplete sa node skrýva (renderer/collider/click/bar), nie je zničený.
- Pridané API pre obnovu depleted uzlov:
  - `CountDepleted(ResourceType)`
  - `TryRestoreOneDepleted(ResourceType, int, out FiniteResourceNode)`
  - `TryRestore(int)`

### 3) Detail panel akcie (spodná lišta)
- Do `BuildingDetails` spodnej lišty pribudlo:
  - action tlačidlo
  - cost row s cenami akcie
- Placeholder text „More Content Coming Soon“ ostal ako fallback, keď budova nemá definovanú akciu.
- Akcia je aktívna pre konkrétne BuildingType podľa konfigurácie.

### 4) BuildingType SO rozšírenie
- `BuildingType` obsahuje nové polia pre finite-node akciu:
  - `finiteNodeAction` (None/Replant/Fertile/NewVein)
  - `finiteNodeActionLabel`
  - `finiteNodeTargetResource`
  - `finiteNodeRestoreAmount`
  - `finiteNodeActionCosts` (list ResourceCost)
- Pridané helper properties (`HasNodeAction`, `NodeActionLabel`, `NodeActionCosts`, ...).

### 5) Prednastavenie pre 3 budovy
- Lumberjack: `Replant` -> target `Wood`
- Farm: `Fertile` -> target `Food`
- Minercamp: `New Vein` -> target `Stone`
- Ceny sú zapisované v BuildingType assetoch cez `finiteNodeActionCosts`.

## Bugfix po implementácii
- Reálny runtime bug: depleted vein sa po cca 3s znova objavil.
- Príčina: node mal zapnutú regeneráciu (`enableRegeneration = true` na prefaboch).
- Oprava v `FiniteResourceNode`:
  - keď `destroyOnDepleted && IsDepleted`, regenerácia sa nespúšťa
  - pri deplete sa resetujú regen akumulátory
- Výsledok: node ostáva hidden, kým nie je obnovený akciou.

## Poznámka k UXML
- `IdleMain` scéna používa `GameUI.uxml` (nie `GameHUD.uxml`).
- Action prvky boli doplnené aj do `GameUI.uxml`, aby sa zmena prejavila v runtime.

## Výsledný stav
- Funkcionalita obnovenia finite node cez detail panel je funkčná.
- Bug s opätovným objavením depleted node je opravený.
